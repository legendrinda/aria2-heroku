#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

echo "-----> Install aria2c"
BUILD_DIR=$1
VENDOR_DIR="vendor"
FILE="aria2-1.36.0-linux-gnu-64bit-build1"
DOWNLOAD_URL="https://github.com/q3aql/aria2-static-builds/releases/download/v1.36.0/${FILE}.tar.bz2"

echo "DOWNLOAD_URL = $DOWNLOAD_URL" | indent

cd "$BUILD_DIR"
mkdir -p "$VENDOR_DIR/aria2c"
cd "$VENDOR_DIR/aria2c"

# download file explicitly with correct name
wget -q "$DOWNLOAD_URL" -O "${FILE}.tar.bz2"

# extract
tar -xvjf "${FILE}.tar.bz2"

# move binary
mv "$FILE"/* .
rm -rf "$FILE" "${FILE}.tar.bz2"

echo "exporting PATH" | indent
PROFILE_PATH="$BUILD_DIR/.profile.d/aria2c.sh"
mkdir -p "$(dirname "$PROFILE_PATH")"
echo 'export PATH="$PATH:${HOME}/vendor/aria2c"' >> "$PROFILE_PATH"
